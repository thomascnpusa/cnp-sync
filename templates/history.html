<!DOCTYPE html>
<html>
<head>
    <title>Production Order History</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <style>
        .excel-table { width: 100%; border-collapse: collapse; margin-bottom: 20px; }
        .excel-table th, .excel-table td { border: 1px solid #ddd; padding: 8px; text-align: left; }
        .excel-table th { background: #ecf0f1; }
        .filter-form { margin-bottom: 20px; }
        .btn { padding: 5px 10px; }
    </style>
</head>
<body>
    <div class="navbar">
        <a href="/">Home</a>
        <a href="/sync">Sync</a>
        <a href="/inventory">Inventory</a>
        <a href="/receive">Receive</a>
        <a href="/produce">Produce</a>
        <a href="/fulfill">Fulfill Orders</a>
        <a href="/adjust">Adjust</a>
        <a href="/sales">Sales</a>
        <a href="/manual-sale">Manual Sale</a>
        <a href="/history">Order History</a>
    </div>
    <div class="container">
        <h1>Production Order History</h1>
        <form method="GET" class="filter-form">
            <label>Status: </label>
            <select name="status">
                <option value="All" {% if status_filter == 'All' %}selected{% endif %}>All</option>
                <option value="Pending" {% if status_filter == 'Pending' %}selected{% endif %}>Pending</option>
                <option value="Fulfilled" {% if status_filter == 'Fulfilled' %}selected{% endif %}>Fulfilled</option>
            </select>
            <label>Product ID: </label>
            <input type="text" name="product" value="{{ product_filter }}">
            <label>Batch: </label>
            <input type="text" name="batch" value="{{ batch_filter }}">
            <button type="submit" class="btn">Filter</button>
            <a href="{{ url_for('main.history', status=status_filter, product=product_filter, batch=batch_filter, export='true') }}" class="btn">Export CSV</a>
        </form>
        {% if orders %}
            <table class="excel-table">
                <thead>
                    <tr>
                        <th>Order ID</th>
                        <th>Batch</th>
                        <th>Product</th>
                        <th>Quantity</th>
                        <th>Status</th>
                        <th>Submitted</th>
                        <th>Fulfilled</th>
                        <th>Notes</th>
                        <th>Operator</th>
                    </tr>
                </thead>
                <tbody>
                    {% for order in orders %}
                        <tr>
                            <td><a href="{{ url_for('main.order_detail', order_id=order.order_id) }}">{{ order.order_id }}</a></td>
                            <td>{{ order.production_batch }}</td>
                            <td>{{ order.product.product_name }} ({{ order.product_id }})</td>
                            <td>{{ order.quantity_to_produce }} {{ order.product.default_unit_of_measure }}</td>
                            <td>{{ order.status }}</td>
                            <td>{{ order.date_submitted }}</td>
                            <td>{{ order.date_fulfilled or 'N/A' }}</td>
                            <td>{{ order.notes or 'N/A' }}</td>
                            <td>{{ order.operator.username if order.operator else 'N/A' }}</td>
                        </tr>
                    {% endfor %}
                </tbody>
            </table>
        {% else %}
            <p>No production orders found.</p>
        {% endif %}
    </div>
</body>
</html>